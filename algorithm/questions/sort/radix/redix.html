<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>基数排序演示</title>
  <style>
    body {
      height: 100vh;
      font-family: sans-serif;
      margin: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #container {
      position: relative;
      width: 600px;
      height: 300px;
      border: 1px solid #ccc;
      margin-bottom: 20px;
    }
    .bar {
      position: absolute;
      bottom: 0;
      width: 40px;
      background-color: steelblue;
      text-align: center;
      color: white;
      line-height: 20px;
      transition: left 0.5s ease, border 0.5s ease;
    }
    #recursionInfo {
      margin-bottom: 20px;
      font-size: 16px;
      color: #555;
    }
    #startBtn {
      padding: 10px 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h2>基数排序演示</h2>
  <div id="container"></div>
  <div id="recursionInfo">排序信息将在此显示</div>
  <button id="startBtn">开始排序</button>
  
  <script>
    const container = document.getElementById('container');
    const startBtn = document.getElementById('startBtn');
    const recursionInfo = document.getElementById('recursionInfo');
    const barWidth = 40;
    const gap = 20;
    let bars = [];
    // 示例数组，适合基数排序的演示
    let values = [170, 45, 75, 90, 180, 24, 2, 66];

    // 初始化柱状图
    function init() {
      container.innerHTML = '';
      bars = [];
      for (let i = 0; i < values.length; i++) {
        const bar = document.createElement('div');
        bar.classList.add('bar');
        bar.style.height = values[i] + 'px';
        bar.style.left = (i * (barWidth + gap)) + 'px';
        bar.textContent = values[i];
        container.appendChild(bar);
        bars.push(bar);
      }
      recursionInfo.textContent = '排序信息将在此显示';
    }

    // 延时函数
    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // 更新柱子位置
    function updatePositions() {
      for (let i = 0; i < bars.length; i++) {
        bars[i].style.left = (i * (barWidth + gap)) + 'px';
      }
    }

    // 获取数字在指定基位（exp）上的数值
    function getDigit(num, exp) {
      return Math.floor(num / exp) % 10;
    }

    // 基数排序演示函数（LSD法）
    async function radixSort() {
      let maxDigits = Math.max(...values).toString().length;
      // 初始数组记录（确保显示值与实际数值一致）
      let nums = values.slice();

      // 每一轮按照位数（从个位开始）
      for (let exp = 1, pass = 1; Math.floor(Math.max(...nums) / exp) > 0; exp *= 10, pass++) {
        recursionInfo.textContent = `正在按第 ${pass} 轮（基位：${exp}）进行分配`;
        // 初始化10个桶
        const buckets = Array.from({ length: 10 }, () => []);
        
        // 分桶：遍历bars数组，依据当前位整理到桶中
        for (let i = 0; i < nums.length; i++) {
          let digit = getDigit(nums[i], exp);
          // 动画效果：标记当前处理的柱子
          bars[i].style.border = '3px solid orange';
          await sleep(300);
          buckets[digit].push({ value: nums[i], bar: bars[i] });
          // 还原样式
          bars[i].style.border = 'none';
        }
        
        // 合并桶，生成新的有序数组
        let index = 0;
        // 清空 nums 与 bars 数组，随后更新
        for (let b = 0; b < 10; b++) {
          if (buckets[b].length > 0) {
            for (let item of buckets[b]) {
              // 动画展示：改变颜色后放回到容器中
              item.bar.style.backgroundColor = 'red';
              await sleep(300);
              nums[index] = item.value;
              bars[index] = item.bar;
              // 更新文本，以确保数字显示正确
              bars[index].textContent = item.value;
              updatePositions();
              await sleep(300);
              item.bar.style.backgroundColor = 'steelblue';
              index++;
            }
          }
        }
        // 更新整个柱状图顺序后，等待一会儿
        await sleep(600);
      }
      recursionInfo.textContent = '排序完成！';
    }

    // 事件绑定及启动排序
    startBtn.addEventListener('click', async () => {
      startBtn.disabled = true;
      init();
      // 更新 values 数组以便后续调用（保持与柱子初始高度一致）
      values = bars.map(bar => parseInt(bar.textContent));
      await radixSort();
      startBtn.disabled = false;
    });

    init();
  </script>
</body>
</html>